openapi: 3.0.3
info:
  title: ERP REST API
  version: 0.1.0
paths:
  /api/services/v1/operations/getping:
    post:
      summary: Alive check
      description: When system is alive, returns "pong"
      responses:
        '200':
          description: Successful Response
          content:
            text/plain:
              schema:
                type: string
                example: pong
      tags:
        - operations
        
  /api/services/v1/operations/authorize:
    parameters:
      - name: response_type
        in: query
        description: Tells the authorization server which grant to execute.
        schema:
          type: string
          default: "code"
        required: true
      - name: client_id
        in: query
        description: The ID of the application that asks for authorization.
        schema:
          type: string
          format: uuid
          default: "028e12d1-be7a-4913-b797-7e848c4e4977"
        required: true
      - name: redirect_uri
        in: query
        description: Holds a URL. A successful response from this endpoint results in a redirect to this URL.
        schema:
          type: string
        required: true
      - name: state
        in: query
        description: An opaque value, used for security purposes. If this request parameter is set in the request, then it is returned to the application as part of the redirect_uri.
        schema:
          type: string
        required: true
        
    post:
      summary: Authentication
      description: The /api/services/v1/oauth/authorize endpoint is used to interact with the resource owner and get the authorization to access the protected resource.
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                required:
                  - access_token
                  - token_type
                  - expires_in
                  - refresh_token
                properties:
                  access_token:
                    type: string
                    example: '028e12d1-be7a-4913-b797-7e848c4e4977'
                    description: The access token string as issued by the authorization server.
                  token_type:
                    type: string
                    example: 'bearer'
                    description: The type of token this is, typically just the string “bearer”.
                  expires_in:
                    type: string
                    format: datetime
                    example: '2012-04-23T18:25:43.511Z'
                    description: If the access token expires, the server should reply with the duration of time the access token is granted for.
                  refresh_token:
                    type: string
                    example: '028e12d1-be7a-4913-b797-7e848c4e4977'
                    description: If the access token will expire, then it is useful to return a refresh token which applications can use to obtain another access token. However, tokens issued with the implicit grant cannot be issued a refresh token.
      tags:
        - operations
        
  /api/services/v1/operations/token:
    post:
      summary: Token endpoint
      description: The /api/services/v1/oauth/token endpoint is used by the application in order to get an access token or a refresh token. It is used by all flows except for the Implicit Flow because in that case an access token is issued directly.
      responses:
        '200':
          description: Successful Response
          content:
            text/plain:
              schema:
                type: string
      tags:
        - operations



  /api/services/v1/invoices/checkinvoiceinpdf:
    parameters:
      - name: type
        in: query
        description: Decision of invoice type - default value "invoice"
        schema: 
          type: string
          enum:
            - proforma
            - invoice
          default: invoice
        required: false
    post:
      summary: Checks existence of generated invoice in PDF
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/PaymentReference'
      responses:
        200:
          description: Successful Response
        404:
          description: Invoice not found
      description: Returns no body content, only checks existence of invoice
      tags:
       - invoices
       
  /api/services/v1/invoices/getinvoicedata:
    parameters:
      - name: type
        in: query
        description: Decision of invoice type - default value "invoice"
        schema: 
          type: string
          enum:
            - proforma
            - invoice
          default: invoice
        required: false
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/PaymentReference'
      summary: Download invoice data
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/Invoice'
        404:
          description: Invoice not found

      tags:
        - invoices
  
  /api/services/v1/invoices/getinvoicedatapdf:
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/PaymentReference'
      summary: Download invoice data with PDF
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/InvoicePDF'
        404:
          description: Invoice not found
      tags:
        - invoices
  
  /api/services/v1/invoices/getcustomerinvoice:
    post:
      summary: Filter invoices, return invoice data
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/CustomerId'
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                type: array
                items:
                  $ref: '#/components/schemas/Invoice'
        404:
          description: Customer id not found
            
      tags:
        - invoices

  /api/services/v1/invoices/createinvoice:
    post:
      summary: Creates new invoice
      requestBody:
        required: true
        content:
          application/json:
            schema: 
                $ref: '#/components/schemas/InvoiceInput'
      responses:
        200:
          description: Invoice created
          content:
              application/json:
                schema: 
                  $ref: '#/components/schemas/Invoice'
        412:
          description: "Validation failed"  
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/ErrorValidation'
      tags:
         - invoices

 
 
  /api/services/v1/customers/getcustomerdata:
    post:
      summary: Get customers from ERP
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/IdentificationNumber'
      responses:
          200:
            description: Successful Response
            content:
              application/json:
                schema:
                  type: array
                  items:
                      $ref: '#/components/schemas/Customer'
      tags:
       - customers
  
  /api/services/v1/customers/createcustomer:
    post:
      summary: Create customer in ERP
      requestBody:
        description: Optional description in *Markdown*
        required: true
        content:
          application/json:
            schema: 
                $ref: '#/components/schemas/CustomerInput'
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                allOf:
                  - $ref: '#/components/schemas/Customer'
                  - type: object
                    properties:
                      customerId: 
                        type: string
                        format: uuid
                        description: ERP guid
                        example: 67f65327-6ff5-4d2d-a967-7987773dbc5b
        412:
          description: "Validation failed"  
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/ErrorValidation'
      tags:
       - customers
  
  /api/services/v1/customers/getcustomerbyid:
    post:
      summary: Get one customer from ERP
      requestBody:
        description: ERP guid
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerId'
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                allOf:
                  - $ref: '#/components/schemas/Customer'
                  - type: object
                    properties:
                      customerId: 
                        type: string
                        format: uuid
                        description: ERP guid
                        example: 67f65327-6ff5-4d2d-a967-7987773dbc5b
        404:
          description: Customer not found
      tags:
       - customers
    
  /api/services/v1/customers/updatecustomer:
    post:
      summary: Update customer in ERP
      requestBody:
        description: All fields are optional except __"customerId"__.
        required: true
        content:
          application/json:
            schema: 
                $ref: '#/components/schemas/CustomerInputWithId'
      responses:
        200:
          description: Successful Response
          content:
            application/json:
              schema: 
                allOf:
                  - $ref: '#/components/schemas/Customer'
                  - type: object
                    properties:
                      customerId: 
                        type: string
                        format: uuid
                        description: ERP guid
                        example: 67f65327-6ff5-4d2d-a967-7987773dbc5b
        412:
          description: "Validation failed"  
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/ErrorValidation' 
      tags:
       - customers



components:
  schemas:
    CustomerInput:
      allOf:
      - type: object
        properties:
          _data:
            type: object
            required:
              - name
              - identificationNumber
              - isVatPayer
              - street
              - city
              - postCode
              - countryCode
              - email
            properties:
              name: 
                type: string
                description: Name of the customers company.
                example: Prvni vzduchoplavecka a.s.
              isActive:
                type: boolean
                description: When customer is manual checked -> marked as true
                example: true
              identificationNumber:
                description: Identification number of the customer (IČO)
                type: string
                example: "123456789"
              vatNumber:
                description: VAT number of the customer (DIČ).
                type: string
                example: "10000001"
              vatIdentificationNumber:
                description: Slovak IC DIC
                type: string
                example: "10000001"
              isVatPayer:
                type: boolean
                description: Whether the customer is a VAT payer or not.
                example: true
              street:
                description: Street from the customers address.
                type: string
                example: U plynojemu 69
              city:
                description: City from the customers address.
                type: string
                example: Pardubice
              postCode:
                description: Post code from the customers address.
                type: string
                example: "32000"
              countryCode:
                description: Code of country from the customers address - ISO 3166-1 alpha-3 - uppercase.
                format: countryCode
                type: string
                example: CZE
              telephone:
                description: Customers telephone number with country prefix.
                format: phone
                type: string
                example: "+420605413742"
              email:
                description: Customers e-mail address
                type: string
                format: email
                example: kapitan@vzduchoplavecka.cz
          
    CustomerInputWithId:
      allOf:
      - $ref: '#/components/schemas/CustomerInput'
      - type: object
        properties:
          _data:
            type: object
            required:
              - customerId
            properties:
              customerId: 
                type: string
                format: uuid
                description: ERP guid
                example: 67f65327-6ff5-4d2d-a967-7987773dbc5b
                
    Customer:
      allOf:
      - type: object
        required:
          - name
          - identificationNumber
          - isVatPayer
          - street
          - city
          - postCode
          - countryCode
          - email
          - customerId
        properties:
          name: 
            type: string
            description: Name of the customers company.
            example: Prvni vzduchoplavecka a.s.
          isActive:
            type: boolean
            description: When customer is manual checked -> marked as true
            example: true
          identificationNumber:
            description: Identification number of the customer (IČO)
            type: string
            example: "123456789"
          vatNumber:
            description: VAT number of the customer (DIČ).
            type: string
            example: "10000001"
          vatIdentificationNumber:
            description: Slovak IC DIC
            type: string
            example: "10000001"
          isVatPayer:
            type: boolean
            description: Whether the customer is a VAT payer or not.
            example: true
          street:
            description: Street from the customers address.
            type: string
            example: U plynojemu 69
          city:
            description: City from the customers address.
            type: string
            example: Pardubice
          postCode:
            description: Post code from the customers address.
            type: string
            example: "32000"
          countryCode:
            description: Code of country from the customers address - ISO 3166-1 alpha-3 - uppercase.
            format: countryCode
            type: string
            example: CZE
          telephone:
            description: Customers telephone number with country prefix.
            format: phone
            type: string
            example: "+420605413742"
          email:
            description: Customers e-mail address
            type: string
            format: email
            example: kapitan@vzduchoplavecka.cz
          customerId: 
            type: string
            format: uuid
            description: ERP guid
            example: 67f65327-6ff5-4d2d-a967-7987773dbc5b
          
              
    InvoiceInput:
      allOf:
      - type: object
        required:
          - _data
        properties:
          _data:
            required:
              - legalEntity
              - customer
            properties:
              legalEntity:
                type: string
                description: Legal Entity of Company
                enum:
                  - HEG
                  - HEF
                  - CEN
                  - OCS
              customer:
                required:
                  - paymentReferenceId
                  - currency
                  - countryCode
                  - type
                  - customerId
                  - items
                properties:
                  paymentReferenceId:
                    type: integer
                    description: "Variable symbol"
                    example: 120004565
                  currency:
                    description: Three letter currency code by  ISO 4217 
                    type: string
                    example: CZK
                  countryCode:
                    description: Code of country - ISO 3166-1 alpha-3 - uppercase.
                    format: countryCode
                    type: string
                    example: CZE
                  type: 
                    type: string
                    description: Payment source
                    enum:
                      - autopay
                      - manual
                      - paybylink
                      - banktransfer
                      - backwardinvoicing
                      - shoppingcard
                    example: autopay
                  customerId:
                    type: string
                    format: uuid
                    description: GUID from ERP
                    example: '028e12d1-be7a-4913-b797-7e848c4e4977'
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        text:
                          type: string
                          example: Dobití kreditu do PPC systému Heureka.cz
                        amount:
                          type: string
                          format: Decimal
                          description: Price without VAT
                          example: "10.50"
      
    Invoice:
      allOf:
      - type: object
        required:
          - paymentReferenceId
          - currency
          - countryCode
          - type
          - customerId
          - items
          - amount
          - amountVat
          - status
          - createdDate
          - dueDate
        properties:
          paymentReferenceId:
            type: integer
            description: "Variable symbol"
            example: 120004565
          currency:
            description: Three letter currency code by  ISO 4217 
            type: string
            example: CZK
          countryCode:
            description: Code of country - ISO 3166-1 alpha-3 - uppercase.
            format: countryCode
            type: string
            example: CZE
          type: 
            type: string
            description: Payment source
            enum:
              - autopay
              - manual
              - paybylink
              - banktransfer
              - backwardinvoicing
              - shoppingcard
            example: autopay
          customerId:
            type: string
            format: uuid
            description: GUID from ERP
            example: '028e12d1-be7a-4913-b797-7e848c4e4977'
          items:
            type: array
            items:
              type: object
              properties:
                text:
                  type: string
                  example: Dobití kreditu do PPC systému Heureka.cz
                amount:
                  type: string
                  format: Decimal
                  description: Price without VAT
                  example: "10.50"
          amount:
            type: string
            format: Decimal
            description: Price without VAT
            example: "10.50"
          amountVat:
            type: string
            format: Decimal
            description: Price with VAT
            example: "12.50"
          status:
            type: string
            description: Invoice payment status
            enum:
              - paid
              - partially
              - unpaid
          createdDate:
            type: string
            format: date
            description: "Date (datum vytvoreni) ISO 8601"
            example: '2012-04-23T18:25:43.511Z'
          dueDate:
            type: string
            format: date
            description: "Date (termin splatnosti) ISO 8601"
            example: '2012-04-23T18:25:43.511Z'

    InvoicePDF:
      allOf:
      - $ref: '#/components/schemas/Invoice'
      - type: object
        required:
          - pdf
        properties:
            pdf: 
              type: string
              format: byte
              description: Base64-encoded contents invoice PDF
              example: UERG
      
          
    ErrorValidation:
      type: array
      items:
        type: object
        required:
            - field
            - description
        properties:
          field:
            type: string
            description: Name of invalid field 
            example: email
          description: 
            type: string
            description: Error description
            example: 'Email is invalid'
          value: 
            type: string
            description: Value of field
            example: 'vzduchoplavec(a)vzduchoplavecka.cz'
            
    
    PaymentReference:
      allOf:
      - type: object
        properties:
          _data:
            type: object
            required:
              - paymentReferenceId
            properties:
              paymentReferenceId:
                type: integer
                description: Variable symbol
                example: 412354654
            
    CustomerId:
      allOf:
      - type: object
        properties:
          _data:
            type: object
            required:
              - customerId
            properties:
              customerId:
                type: string
                format: uuid
                example: '028e12d1-be7a-4913-b797-7e848c4e4977'
            description: GUID from ERP
    
    IdentificationNumber:
      allOf:
      - type: object
        properties:
          _data:
            type: object
            required:
              - identificationNumber
            properties:
              identificationNumber:
                type: string
                description: identificationNumber IC
                example: '123456789'
  
  securitySchemes:
    oAuth2:
      type: oauth2
      description: This API uses OAuth 2 with the implicit grant flow. [More info](https://api.example.com/docs/auth)
      flows:
        authorizationCode:
          authorizationUrl: "/api/services/v1/operations/authorize"
          tokenUrl: "/api/services/v1/operations/token"
          scopes: {}

security:
  - oAuth2: []
